<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Ekip5</title>


    <style>
        html {
            background-color: #292b2c;
        }
    </style>

    <link rel="stylesheet" href="stylesheets/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/style.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/dark.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/font-icons.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/animate.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/swiper.css" type="text/css" />
    <link rel="stylesheet" href="stylesheets/magnific-popup.css" type="text/css" />

    <link rel="stylesheet" href="stylesheets/responsive.css" type="text/css" />
</head>

<body>

    <section id="container-all">
        <div id="wrapper">
            <div id="two-titles">
                <div id="logo-Graduation-Chain">
                </div>
                <h3 class="text-center" style="margin-top: 20px; color: #909090;">Envoyez et récupérez votre diplôme de
                    manière sécurisée</h3>
            </div>
            <div id="form">
                <div class="row justify-content-center space-bottom row-100">
                    <div class="col-md-8">
                        <div class="card card-body bg-light" style="border-radius: 10px;">
                            <div class="row justify-content-center">
                                <form class="" action="/" method="post" id="formToken">
                                    <input type="file" name="message" id="message" placeholder="Upload your file"
                                        size="100" autofocus />
                                    <input class="btn btn-danger" type="submit" id="envoi_message" value="Envoyer" />
                                </form>
                            </div>

                        </div>
                    </div>
                </div>


                <div class="row justify-content-center mt-10 row-100">
                    <div class="col-md-8">
                        <div class="card card-body bg-light" style="border-radius: 10px;">
                            <div class="row justify-content-center">
                                <form class="" action="/" method="post" id="recupdata">
                                    <input type="text" name="messagesend" class="input-text" id="messagerecup"
                                        placeholder="send text file" size="60" autofocus />
                                    <input class="btn btn-danger" type="submit" id="envoi_img" value="Vérifier le diplome" />

                                </form>

                            </div>
                            <section id="getData">
                    
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>

</body>

<script src="javascripts/jquery.js"></script>
<script src="javascripts/plugins.js"></script>
<script src="javascripts/functions.js"></script>
<script src="javascripts/jquery.gmap.js"></script>
<script>

    function insereMessage(response) {
        console.log('%cindex.html line:85 response', 'color: #007acc;', response);
        const myNode = document.getElementById("getData");
        myNode.innerHTML = '';
        if(response !== 1){
            myNode.innerHTML = response.hash
        }
        else if(response == 1){
            myNode.innerHTML = "Rien trouvé "
        }
        
    }

    $('#recupdata').submit(function (e) {
        e.preventDefault();
        let message = $('#messagerecup').val();

        if (message != "") {
            const encoreString = encodeURIComponent(message)
            fetch(`http://127.0.0.1:8080/api/getTransaction/${encoreString}`, {
                mode: 'cors',
                headers: {
                    'Access-Control-Allow-Origin': '*',
                    "content-type": "application/json"
                }
            }).then((response) => {
                console.log('%cindex.html line:105 response', 'color: #007acc;', response);
                return response.json();
            }).then((data) => {
                console.log('%cindex.html line:88 response', 'color: #007acc;', data);
                if(data !== undefined){
                    insereMessage(data);
                }
            }).catch((err) =>{
                console.log('%cindex.html line:110 err', 'color: #007acc;', err);
                insereMessage(1)
            })        
        }
    });

    $('#senddata').submit(function (e) {
        e.preventDefault();
        let message = $('#message').val();

        if (message != "") {
            console.log('Msg:', message)
            const encoreString = encodeURIComponent(message)
            fetch(`http://127.0.0.1:5000/save/${encoreString}`, {
                mode: 'cors',
                headers: {
                    'Access-Control-Allow-Origin': '*',
                    "content-type": "application/json"
                }
            }).then((response) => {
                return response.json();
            })
        }
    });


</script>


</html>